<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>ƒê·ªçc truy·ªán - MyLocalManga</title>
    <link rel="stylesheet" href="/src/styles/base.css" />
    <link rel="stylesheet" href="/src/styles/pages/reader.css" />
    <link rel="stylesheet" href="/src/styles/dark/reader-dark.css" />
    <script type="module">
      import { renderReader } from "/src/core/reader/index.js";
      import { getRootFolder } from "/src/core/storage.js";

      window.addEventListener("DOMContentLoaded", async () => {
        const params = new URLSearchParams(window.location.search);
        const path = params.get("path");
        if (!path) return alert("Thi·∫øu path!");

        const root = getRootFolder();
        if (!root) {
          window.location.href = "/select.html";
          return;
        }

        try {
          const res = await fetch(
            `/api/folder-cache?mode=path&root=${encodeURIComponent(
              root
            )}&path=${encodeURIComponent(path)}`
          );
          const data = await res.json();

          if (data.type !== "reader" || !Array.isArray(data.images)) {
            alert("‚ùå Folder kh√¥ng h·ª£p l·ªá ho·∫∑c kh√¥ng c√≥ ·∫£nh!");
            return;
          }

          renderReader(data.images);
        } catch (err) {
          console.error("‚ùå L·ªói load d·ªØ li·ªáu:", err);
          alert("üö´ L·ªói khi t·∫£i ·∫£nh!");
        }
      });
    </script>
  </head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <header id="site-header">
    <div class="header-icons">
      <!-- C√°c n√∫t s·∫Ω ƒë∆∞·ª£c JS g·∫Øn t·ª± ƒë·ªông t·ª´ reader/index.js -->
    </div>
    <h1
      style="margin: 0; cursor: pointer"
      onclick="window.location.href='index.html'"
    >
      üìö MyLocalManga
    </h1>
  </header>

  <body>
    <div id="app"></div>
  </body>
  <footer id="reader-footer" class="hidden">
    <div class="reader-footer-inner">
      <button id="prev-chapter-btn">‚¨Ö Prev</button>
      <div style="text-align: center">
        <div id="page-info">Trang ? / ?</div>
        <div
          id="image-count-info"
          style="font-size: 13px; color: #ccc; margin-top: 2px"
        >
          ? / ? (Page: ?)
        </div>
      </div>
      <button id="next-chapter-btn">Next ‚û°</button>
    </div>
  </footer>
</html>
