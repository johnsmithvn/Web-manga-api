<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Đọc truyện - MyLocalManga</title>
    <link rel="stylesheet" href="/src/styles/base.css" />
    <link rel="stylesheet" href="/src/styles/pages/reader.css" />
    <link rel="stylesheet" href="/src/styles/dark/reader-dark.css" />
    <!-- <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script> -->
    <script type="module">
      import { renderReader } from "/src/core/reader/index.js";
      import { getRootFolder } from "/src/core/storage.js";

      window.addEventListener("DOMContentLoaded", async () => {
        const params = new URLSearchParams(window.location.search);
        const path = params.get("path");
        if (!path) return alert("Thiếu path!");

        const root = getRootFolder();
        if (!root) {
          window.location.href = "/select.html";
          return;
        }

        try {
          const res = await fetch(
            `/api/list-folder?root=${encodeURIComponent(
              root
            )}&path=${encodeURIComponent(path)}`
          );
          const data = await res.json();

          if (data.type !== "reader" || !Array.isArray(data.images)) {
            alert("❌ Folder không hợp lệ hoặc không có ảnh!");
            return;
          }

          renderReader(data.images);
        } catch (err) {
          console.error("❌ Lỗi load dữ liệu:", err);
          alert("🚫 Lỗi khi tải ảnh!");
        }
      });
    </script>
  </head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <header id="site-header" class="site-header">
    <aside id="sidebar" class="sidebar hidden"></aside>
    <button id="sidebarToggle">📚</button>

    <h1 id="reader-folder-name" title="..." class="truncate-folder-name">
      ...
    </h1>

    <button id="searchToggle">🔍</button>
  </header>


  <!-- SEARCH FLOATING BOX DÙNG CHUNG -->
  <div class="floating-search" id="floatingSearchBox">
    <input type="text" id="search-input" placeholder="Tìm truyện..." />
    <div id="search-dropdown" class="hidden"></div>
  </div>

  <body>
    <div id="app"></div>
  </body>
  <footer id="reader-footer" class="hidden">
    <div class="reader-footer-inner">
      <button id="prev-chapter-btn">⬅ Prev</button>
      <div style="text-align: center">
        <div id="page-info">Trang ? / ?</div>
        <div
          id="image-count-info"
          style="font-size: 13px; color: #ccc; margin-top: 2px"
        >
          ? / ? (Page: ?)
        </div>
      </div>
      <button id="next-chapter-btn">Next ➡</button>
    </div>
  </footer>
</html>
